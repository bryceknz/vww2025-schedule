class TimeFormat{constructor(){this.toggleButton=document.getElementById("timeFormatToggle"),this.toggleIcon=this.toggleButton?.querySelector(".header-toggle-icon"),this.storageKey="vww2025-time-format",this.currentFormat="12hr",this.init()}init(){this.toggleButton&&(this.setInitialFormat(),this.toggleButton.addEventListener("click",()=>this.toggleFormat()))}setInitialFormat(){const t=localStorage.getItem(this.storageKey);t&&(this.currentFormat=t),this.updateButtonDisplay()}toggleFormat(){this.currentFormat="12hr"===this.currentFormat?"24hr":"12hr",this.updateButtonDisplay(),localStorage.setItem(this.storageKey,this.currentFormat),this.animateClick(),filterEvents()}animateClick(){this.toggleButton&&(this.toggleButton.style.transform="scale(1.2)",setTimeout(()=>{this.toggleButton.style.transform="scale(1)"},150))}updateButtonDisplay(){this.toggleIcon&&(this.toggleIcon.textContent="🕐")}formatTime(t){return"24hr"===this.currentFormat?this.formatTo24Hour(t):this.formatTo12Hour(t)}formatTo24Hour(t){if(t.includes(" - ")){const[e,n]=t.split(" - ");return`${this.formatTo24Hour(e)} - ${this.formatTo24Hour(n)}`}if("After Dark"===t)return"18:30";if("All Weekend"===t)return"00:00";if("midnight"===t)return"00:00";if(t.includes("Saturday"))return"10:00";const e=t.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!e)return t;let n=parseInt(e[1]);const o=e[2],r=e[3].toUpperCase();return"PM"===r&&12!==n&&(n+=12),"AM"===r&&12===n&&(n=0),`${n.toString().padStart(2,"0")}:${o}`}formatTo12Hour(t){if(t.includes(" - ")){const[e,n]=t.split(" - ");return`${this.formatTo12Hour(e)} - ${this.formatTo12Hour(n)}`}if("18:30"===t)return"After Dark";if("00:00"===t)return"midnight";if("10:00"===t&&t.includes("Saturday"))return"Saturday 10am-5pm";if(t.includes("AM")||t.includes("PM"))return t;const e=t.match(/(\d{1,2}):(\d{2})/);if(!e)return t;let n=parseInt(e[1]);const o=n>=12?"PM":"AM";return n>12&&(n-=12),0===n&&(n=12),`${n}:${e[2]} ${o}`}}class DarkMode{constructor(){this.toggleButton=document.getElementById("darkModeToggle"),this.toggleIcon=this.toggleButton?.querySelector(".header-toggle-icon"),this.storageKey="vww2025-theme-preference",this.init()}init(){this.toggleButton&&(this.setInitialTheme(),this.toggleButton.addEventListener("click",()=>this.toggleTheme()),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{this.hasStoredPreference()||this.applyTheme(t.matches?"dark":"light")}))}setInitialTheme(){const t=localStorage.getItem(this.storageKey);if(t)this.applyTheme(t);else{const t=window.matchMedia("(prefers-color-scheme: dark)").matches;this.applyTheme(t?"dark":"light")}}toggleTheme(){const t=document.documentElement.getAttribute("data-theme"),e=window.matchMedia("(prefers-color-scheme: dark)").matches,n="dark"===(t||(e?"dark":"light"))?"light":"dark";this.applyTheme(n),localStorage.setItem(this.storageKey,n),this.animateClick()}animateClick(){this.toggleButton&&(this.toggleButton.style.transform="scale(1.2)",setTimeout(()=>{this.toggleButton.style.transform="scale(1)"},150))}applyTheme(t){document.documentElement.setAttribute("data-theme",t),this.toggleIcon&&(this.toggleIcon.textContent="dark"===t?"☀️":"🌙")}hasStoredPreference(){return null!==localStorage.getItem(this.storageKey)}}let timeFormat;function isEventPast(t){const e=new Date,n=e.getDay(),o=60*e.getHours()+e.getMinutes(),r={5:1,6:2,0:3}[n],i={friday:1,saturday:2,sunday:3,all:4}[t.day];if(4===i)return!1;if("After Dark"===t.time)return!1;if("All Weekend"===t.time)return!1;if(void 0===r)return!1;if(r>i)return!0;if(r===i){if(t.time.includes(" - ")){const[e,n]=t.time.split(" - ");parseTimeToMinutes(e);return o>parseTimeToMinutes(n)+60}return o>parseTimeToMinutes(t.time)+60}return!1}function parseTimeToMinutes(t){if("midnight"===t)return 1440;if("After Dark"===t)return 1110;const e=t.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!e)return 0;let n=parseInt(e[1]);const o=parseInt(e[2]),r=e[3].toUpperCase();return"PM"===r&&12!==n&&(n+=12),"AM"===r&&12===n&&(n=0),60*n+o}function convertTo24Hour(t){if(t.includes(" - ")){const[e,n]=t.split(" - ");return`${convertTo24Hour(e)} - ${convertTo24Hour(n)}`}if("After Dark"===t)return"18:30";if("All Weekend"===t)return"00:00";if("midnight"===t)return"00:00";if(t.includes("Saturday"))return"10:00";const e=t.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!e)return t;let n=parseInt(e[1]);const o=e[2],r=e[3].toUpperCase();return"PM"===r&&12!==n&&(n+=12),"AM"===r&&12===n&&(n=0),`${n.toString().padStart(2,"0")}:${o}`}function renderSchedule(t=events){const e=document.getElementById("schedule");if(0===t.length)return void(e.innerHTML='<div class="no-events">No events found matching your criteria.</div>');const n={};t.forEach(t=>{n[t.day]||(n[t.day]=[]),n[t.day].push(t)}),Object.keys(n).forEach(t=>{n[t].sort((t,e)=>{const n=convertTo24Hour(t.time),o=convertTo24Hour(e.time);return n.localeCompare(o)})});let o="";["friday","saturday","sunday","all"].forEach(t=>{if(n[t]&&n[t].length>0){const e="all"===t?"All Weekend":t.charAt(0).toUpperCase()+t.slice(1);o+=`\n        <div class="day-section">\n          <div class="day-header">${e}</div>\n          <div class="events-container">\n      `,n[t].forEach(t=>{const e=`location-${t.location}`,n=locationMap[t.location]||t.location;o+=`\n          <div class="event">\n            <div class="event-time">${timeFormat?timeFormat.formatTime(t.time):t.time}</div>\n            <div class="event-title">${t.title}</div>\n            <div class="event-location ${e}">${n}</div>\n            ${t.description?`<div class="event-description">${t.description.replace(/\n/g,"\n")}</div>`:""}\n          </div>\n        `}),o+="\n          </div>\n        </div>\n      "}}),e.innerHTML=o}function filterEvents(){const t=document.getElementById("dayFilter").value,e=document.getElementById("locationFilter").value,n=document.getElementById("categoryFilter").value,o=document.getElementById("searchBox").value.toLowerCase();renderSchedule(events.filter(r=>{const i="all"===t||r.day===t,a="all"===e||r.location===e,s="all"===n||r.category===n,l=""===o||r.title.toLowerCase().includes(o)||r.description&&r.description.toLowerCase().includes(o)||locationMap[r.location]&&locationMap[r.location].toLowerCase().includes(o)||r.category&&getCategoryName(r.category).toLowerCase().includes(o),c="all"!==t||!isEventPast(r);return i&&a&&s&&l&&c}))}function updateDayFilter(){const t=document.getElementById("dayFilter"),e=t.querySelector('option[value="all"]');t.innerHTML="",t.appendChild(e);[{value:"friday",label:"Friday"},{value:"saturday",label:"Saturday"},{value:"sunday",label:"Sunday"}].forEach(e=>{const n=document.createElement("option");n.value=e.value,n.textContent=e.label,t.appendChild(n)})}function populateLocationFilter(){const t=document.getElementById("locationFilter");Object.entries(locationMap).forEach(([e,n])=>{const o=document.createElement("option");o.value=e,o.textContent=n,t.appendChild(o)})}function populateCategoryFilter(){const t=document.getElementById("categoryFilter");Object.entries(categories).forEach(([e,n])=>{const o=document.createElement("option");o.value=e,o.textContent=`${n.icon} ${n.name}`,t.appendChild(o)})}document.addEventListener("DOMContentLoaded",function(){timeFormat=new TimeFormat,new DarkMode,updateDayFilter(),populateLocationFilter(),populateCategoryFilter(),document.getElementById("dayFilter").addEventListener("change",filterEvents),document.getElementById("locationFilter").addEventListener("change",filterEvents),document.getElementById("categoryFilter").addEventListener("change",filterEvents),document.getElementById("searchBox").addEventListener("input",filterEvents),filterEvents()});